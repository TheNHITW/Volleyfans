<h2>Gestione Classifiche Torneo</h2>

<!-- ðŸ”¹ Selezione opzioni -->
<div style="margin-bottom: 1.5rem;">
  <label for="eventDate">Data torneo:</label>
  <select id="eventDate" [(ngModel)]="selectedDate" (change)="onDateChange()">
    <option *ngFor="let d of availableDates" [value]="d">{{ d }}</option>
  </select>

  <label for="teamCount" style="margin-left: 1rem;">Numero squadre:</label>
  <select [(ngModel)]="selectedTeamCount" (change)="onTeamCountChange()">
    <option *ngFor="let count of [12,13,14,15,16]" [ngValue]="count">{{ count }}</option>
  </select>
</div>

<!-- ðŸ”¹ Formula suggerita -->
<div *ngIf="strutturaGironiSuggerita">
  <h4>Formula di gara suggerita:</h4>
  <ul>
    <li *ngFor="let girone of gironiLettere">
      Girone {{ girone }}: {{ strutturaGironiSuggerita[girone] || 0 }} squadre
    </li>
  </ul>
  <button (click)="assegnaGironiAutomaticamente()">Assegna gironi automaticamente</button>
</div>

<!-- ðŸ”¹ Squadre selezionate -->
<h3>Squadre selezionate ({{ filteredTeams.length }})</h3>
<ul>
  <li *ngFor="let team of filteredTeams">{{ team.teamName }}</li>
</ul>

<!-- ðŸ”¹ Assegnazione gironi -->
<h3>Assegna le squadre ai gironi</h3>
<table>
  <thead>
    <tr>
      <th>Squadra</th>
      <th>Girone</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let team of filteredTeams">
      <td>{{ team.teamName }}</td>
      <td>
        <select [value]="assegnazioni[team.teamName] || ''"
                (change)="handleSelectChange($event, team.teamName)">
          <option value="">--</option>
          <option *ngFor="let lettera of gironiLettere" [value]="lettera">Girone {{ lettera }}</option>
        </select>
      </td>
    </tr>
  </tbody>
</table>

<!-- ðŸ”¹ Composizione gironi -->
<h3>Composizione Gironi</h3>
<div class="gironi-grid">
  <div class="girone-block" *ngFor="let lettera of gironiLettere">
    <h4>Girone {{ lettera }}</h4>
    <ul>
      <li *ngFor="let team of gironi[lettera]">{{ team.teamName }}</li>
    </ul>
  </div>
</div>

<!-- ðŸ”¹ Genera match -->
<button (click)="generaMatchGironi()">Calcola match gironi</button>

<!-- ðŸ”¹ Calendario Match -->
<div *ngIf="matchList.length > 0">
  <h3>Calendario Match</h3>
  <table>
    <thead>
      <tr>
        <th>Girone</th>
        <th>Team A</th>
        <th>Team B</th>
        <th>Arbitro</th>
        <th>Campo</th>
        <th>Round</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let match of matchList">
        <td>{{ match.girone }}</td>
        <td>{{ match.teamA }}</td>
        <td>{{ match.teamB }}</td>
        <td>{{ match.referee }}</td>
        <td>{{ match.field }}</td>
        <td>{{ match.round }}</td>
      </tr>
    </tbody>
  </table>
  <button (click)="generaPDF()">ðŸ“„ Esporta in PDF</button>
</div>

<!-- ðŸ”¹ Matrice Risultati -->
<h3>Matrice risultati - Tutti i Gironi</h3>

<ng-container *ngFor="let girone of gironiLettere">
  <div *ngIf="gironi[girone]?.length">
    <h4>Girone {{ girone }}</h4>
    <table class="matrice-risultati">
      <thead>
        <tr>
          <th>Squadra</th>
          <th *ngFor="let squadraCol of gironi[girone]">{{ squadraCol.teamName }}</th>
          <th>Vittorie</th>
          <th>Diff. Punti</th>
          <th>Punti</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let squadraRow of gironi[girone]; let i = index">
          <td>{{ squadraRow.teamName }}</td>
          <td *ngFor="let squadraCol of gironi[girone]; let j = index">
            <ng-container *ngIf="i !== j; else diagonale">
              <input
                type="text"
                style="width: 40px; text-align: center;"
                [value]="getDisplayValue(girone, squadraRow.teamName, squadraCol.teamName)"
                (input)="aggiornaRisultatoConVittoria(girone, squadraRow.teamName, squadraCol.teamName, getInputValue($event))"
              />
            </ng-container>
            <ng-template #diagonale>
              <span style="font-size: 15px;">â– </span>
            </ng-template>
          </td>
          <td>{{ calcolaVittorie(girone, squadraRow.teamName) }}</td>
          <td>{{ calcolaDifferenzaPunti(girone, squadraRow.teamName) }}</td>
          <td>{{ calcolaPuntiTotali(girone, squadraRow.teamName) }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</ng-container>
    <button (click)="generaPDFRisultati()">ðŸ“„ Esporta risultati in PDF</button>
