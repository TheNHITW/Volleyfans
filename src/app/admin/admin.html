<h1>Area Admin</h1>

  <!-- ðŸ”˜ Selezione della data -->
  <mat-form-field appearance="fill" class="full-width" style="max-width: 300px; margin-bottom: 1rem;">
    <mat-label>Seleziona una data</mat-label>
    <mat-select [(value)]="selectedDate" (selectionChange)="onDateChange()">
      <mat-option *ngFor="let date of availableDates" [value]="date.value">
        {{ date.label }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <!-- ðŸ”˜ Select vista (NUOVO) -->
  <mat-form-field appearance="fill" class="full-width" style="max-width: 240px; margin-bottom: 1rem; margin-left: 0.5rem;">
    <mat-label>Vista</mat-label>
    <mat-select [(value)]="viewMode" (selectionChange)="onModeChange()">
      <mat-option value="teams">Squadre</mat-option>
      <mat-option value="aperitivo">Aperitivo</mat-option>
    </mat-select>
  </mat-form-field>

  <!-- ðŸ”˜ Pulsanti principali -->
  <div class="admin-buttons" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
    <button mat-raised-button class="csv-btn" (click)="exportToCSV()">Esporta CSV</button>

    <button mat-raised-button
            [ngClass]="isRegistrationOpen ? 'btn-open' : 'btn-closed'"
            (click)="toggleRegistration()">
      {{ isRegistrationOpen ? 'Iscrizioni Aperte' : 'Iscrizioni Chiuse' }}
    </button>

    <button mat-raised-button class="gestionale-btn" routerLink="/admin/classifiche">Gestionale gara</button>
  </div>

<!-- ðŸ“‹ Tabella squadre (Angular Material) -->
<table
  mat-table
  [dataSource]="teams"
  class="mat-elevation-z1 admin-table"
  *ngIf="viewMode === 'teams' && teams?.length">

  <ng-container matColumnDef="index">
    <th mat-header-cell *matHeaderCellDef> # </th>
    <td mat-cell *matCellDef="let row; let i = index">
      {{ i + 1 }}
    </td>
  </ng-container>

  <!-- Nome Squadra -->
  <ng-container matColumnDef="teamName">
    <th mat-header-cell *matHeaderCellDef>Nome Squadra</th>
    <td mat-cell *matCellDef="let team">{{ team.teamName }}</td>
  </ng-container>

  <ng-container matColumnDef="skillLevel">
    <th mat-header-cell *matHeaderCellDef> Livello </th>
    <td mat-cell *matCellDef="let row">
      {{ row.skillLevel || 'Non specificato' }}
    </td>
  </ng-container>

  <!-- Telefono -->
  <ng-container matColumnDef="phone">
    <th mat-header-cell *matHeaderCellDef>Telefono</th>
    <td mat-cell *matCellDef="let team">{{ team.phone || 'â€”' }}</td>
  </ng-container>

  <!-- Giocatore 1 / Sesso 1 -->
  <ng-container matColumnDef="p1Name">
    <th mat-header-cell *matHeaderCellDef>Giocatore 1</th>
    <td mat-cell *matCellDef="let team">{{ getPlayer(team, 0, 'name') }}</td>
  </ng-container>

  <ng-container matColumnDef="p1Gender">
    <th mat-header-cell *matHeaderCellDef>Sesso 1</th>
    <td mat-cell *matCellDef="let team">{{ getPlayer(team, 0, 'gender') }}</td>
  </ng-container>

  <!-- Giocatore 2 / Sesso 2 -->
  <ng-container matColumnDef="p2Name">
    <th mat-header-cell *matHeaderCellDef>Giocatore 2</th>
    <td mat-cell *matCellDef="let team">{{ getPlayer(team, 1, 'name') }}</td>
  </ng-container>

  <ng-container matColumnDef="p2Gender">
    <th mat-header-cell *matHeaderCellDef>Sesso 2</th>
    <td mat-cell *matCellDef="let team">{{ getPlayer(team, 1, 'gender') }}</td>
  </ng-container>

  <!-- Giocatore 3 / Sesso 3 -->
  <ng-container matColumnDef="p3Name">
    <th mat-header-cell *matHeaderCellDef>Giocatore 3</th>
    <td mat-cell *matCellDef="let team">{{ getPlayer(team, 2, 'name') }}</td>
  </ng-container>

  <ng-container matColumnDef="p3Gender">
    <th mat-header-cell *matHeaderCellDef>Sesso 3</th>
    <td mat-cell *matCellDef="let team">{{ getPlayer(team, 2, 'gender') }}</td>
  </ng-container>

  <!-- Giocatore 4 / Sesso 4 -->
  <ng-container matColumnDef="p4Name">
    <th mat-header-cell *matHeaderCellDef>Giocatore 4</th>
    <td mat-cell *matCellDef="let team">{{ getPlayer(team, 3, 'name') }}</td>
  </ng-container>

  <ng-container matColumnDef="p4Gender">
    <th mat-header-cell *matHeaderCellDef>Sesso 4</th>
    <td mat-cell *matCellDef="let team">{{ getPlayer(team, 3, 'gender') }}</td>
  </ng-container>

  <!-- Azioni -->
  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef>Azioni</th>
    <td mat-cell *matCellDef="let team">
      <button mat-button color="warn" (click)="deleteTeam(team.teamName)">Cancella</button>
    </td>
  </ng-container>

  <!-- Righe -->
  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row        *matRowDef="let row; columns: displayedColumns;"></tr>
</table>

<p *ngIf="viewMode === 'teams' && !teams?.length">
  Nessuna squadra iscritta per la data selezionata.
</p>

<!-- ðŸ“‹ Tabella aperitivo -->
<table
  mat-table
  [dataSource]="aperitivo"
  class="mat-elevation-z1 admin-table"
  *ngIf="viewMode === 'aperitivo' && aperitivo?.length">

  <!-- # -->
  <ng-container matColumnDef="index">
    <th mat-header-cell *matHeaderCellDef> # </th>
    <td mat-cell *matCellDef="let row; let i = index">{{ i + 1 }}</td>
  </ng-container>

  <ng-container matColumnDef="fullName">
    <th mat-header-cell *matHeaderCellDef>Nome e Cognome</th>
    <td mat-cell *matCellDef="let row">{{ row.fullName }}</td>
  </ng-container>

  <ng-container matColumnDef="phone">
    <th mat-header-cell *matHeaderCellDef>Telefono</th>
    <td mat-cell *matCellDef="let row">{{ row.phone || 'â€”' }}</td>
  </ng-container>

  <ng-container matColumnDef="peopleCount">
    <th mat-header-cell *matHeaderCellDef>N. Persone</th>
    <td mat-cell *matCellDef="let row">{{ row.peopleCount }}</td>
  </ng-container>

  <ng-container matColumnDef="teamName">
    <th mat-header-cell *matHeaderCellDef> Squadra </th>
    <td mat-cell *matCellDef="let row">{{ row.teamName || 'â€”' }}</td>
  </ng-container>

  <ng-container matColumnDef="source">
    <th mat-header-cell *matHeaderCellDef> Provenienza </th>
    <td mat-cell *matCellDef="let row">
      {{ row.source === 'Squadra' ? 'Squadra ' + row.teamName : 'Singolo' }}
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedAperColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedAperColumns;"></tr>
</table>

<p *ngIf="viewMode === 'aperitivo' && !aperitivo?.length">Nessun iscritto all'aperitivo per la data selezionata.</p>


